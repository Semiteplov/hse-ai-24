# Итоги работы

## Что было сделано
0. **Небольшой EDA**:
   - Исследована корреляция чисовых признаков.
   - Построены простейшие графики для определения зависимостей между признаками.

1. **Предобработка данных**:
   - Были удалены дубликаты
   - Извлечены числовые признаки, такие как `mileage`, `engine`, `max_power`, из строковых данных (например, "14.0 kmpl"). `torque` разбит на `torque` и `torque_rpm`.
   - Для числовых признаков пропуски заполнены медианой.
   - `engine` и `seats` приведены к числовому типу.
   - Обработаны неизвестные значения в столбце `name` путем замены на категорию `"unknown"`, кодирование проведено с помощью `LabelEncoder`.
   - Остальные категориальные признаки закодированы с помощью `OneHotEncoder`.
   - Числовые признаки масштабированы с использованием `StandardScaler`.
   - Выделены новые признаки: `hp_per_liter` и `year_squared`.
   - Удаены выбросы у признака `max_power`.

2. **Обучение модели**:
   - Использована линейная модель Ridge Regression с подбором гиперпараметров (`alpha` и `max_iter`) через `GridSearchCV`, оптимизированная по метрике `R²`.

3. **Реализация API**:
   - Созданы эндпоинты FastAPI для обработки:
     - Прогнозов для одного объекта (`/predict_item`).
     - Прогнозов для нескольких объектов в JSON (`/predict_items`).
     - Загрузки CSV файлов для массовых прогнозов (`/predict_csv`).
   - В эндпоинте `/predict_csv` добавлена возможность возвращать обработанный файл с результатами.

## Результаты
- **Предобработка данных**:
  - Данные очищены и приведены в единый формат, исключены `NaN` и некорректные значения.
  - Обеспечена обработка категориальных и неизвестных меток при прогнозировании.

- **Производительность модели**:
  - `R²` получилась не очень хорошей, на трейне - `0.7166`, на тесте - `0.6494`.

- **Эндпоинты**:
  - Эндпоинты протестированы с реальными данными в формате JSON и CSV, прогнозы получились слишком уж большими, тут я скорее всего сделал что-то не так, но времени на исправление не осталось.

## Что дало наибольший прирост качества
   - Выделение новых признаков.
   - Обработка encoder'ами категориальных признаков.
   - Использование `GridSearchCV` позволило подобрать оптимальные параметры для Ridge Regression.

## Что сделать не вышло и почему
Просто не хватило времени, по-хорошему, надо более аккуратно проанализировать и обработать признаки, выделить новые более сложные признаки. Признак `name` я бы вообще удалил. \
Можно было бы также использовать более сложную регрессию, CatBoost, например, тогда не было бы нужды в кодировании категориальных признаков.

## Примеры запросов и ответов
### `/predict_item`

#### Запрос
```bash
curl --location 'http://127.0.0.1:8000/predict_item' \
--header 'Content-Type: application/json' \
--data '{
    "name": "Mahindra Xylo E4 BS IV",
    "year": 2010,
    "selling_price": 229999,
    "km_driven": 168000,
    "fuel": "Diesel",
    "seller_type": "Individual",
    "transmission": "Manual",
    "owner": "First Owner",
    "mileage": "14.0 kmpl",
    "engine": "2498 CC",
    "max_power": "112 bhp",
    "torque": "260 Nm at 1800-2200 rpm",
    "seats": 7.0
}'
```
#### Ответ
```json
9315723849.511852
```

### `/predict_items`

#### Запрос
```bash
curl --location 'http://127.0.0.1:8000/predict_items' \
--header 'Content-Type: application/json' \
--data '{
    "objects": [
        {
            "name": "Mahindra Xylo E4 BS IV",
            "year": 2010,
            "km_driven": 168000,
            "fuel": "Diesel",
            "seller_type": "Individual",
            "transmission": "Manual",
            "owner": "First Owner",
            "mileage": "14.0 kmpl",
            "engine": "2498 CC",
            "max_power": "112 bhp",
            "torque": "260 Nm at 1800-2200 rpm",
            "seats": 7.0
        },
        {
            "name": "Hyundai Verna SX CRDi",
            "year": 2015,
            "km_driven": 50000,
            "fuel": "Diesel",
            "seller_type": "Dealer",
            "transmission": "Manual",
            "owner": "First Owner",
            "mileage": "21.1 kmpl",
            "engine": "1582 CC",
            "max_power": "126.2 bhp",
            "torque": "259.87 Nm at 1500-3000 rpm",
            "seats": 5.0
        }
    ]
}'
```
#### Ответ
```json
[
    9315723856.32562,
    9372786809.6624
]
```
### `/predict_csv`

#### Запрос
```bash
curl --location 'http://127.0.0.1:8000/predict_csv' \
--form 'file=@"/C:/cars_test.csv"'
```
#### Ответ
В ответ приходит обновленный csv файл с новым столбцом `predicted_price`

