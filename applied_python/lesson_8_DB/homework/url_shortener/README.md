# üîó HW 8 FastAPI URL Shortener

–°–µ—Ä–≤–∏—Å –¥–ª—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ Redis.

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö URL —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –∫–æ–¥–∞
- ‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∞–ª–∏–∞—Å—ã (`custom_alias`)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ —Å—Å—ã–ª–∫–∏ (`expires_at`)
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (JWT)
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ (–∫–æ–ª-–≤–æ –≤–∏–∑–∏—Ç–æ–≤, –¥–∞—Ç—ã)
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ Redis
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏ –∏—Å—Ç—ë–∫—à–∏—Ö —Å—Å—ã–ª–æ–∫
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É URL

---

## üì¶ API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `POST` | `/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `POST` | `/login` | –ü–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞ |
| `POST` | `/links/shorten` | –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏ *(–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω—É–∂–Ω–∞)* |
| `GET` | `/links/{short_code}` | –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ |
| `GET` | `/links/{short_code}/stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ |
| `GET` | `/links/search?original_url=...` | –ü–æ–∏—Å–∫ –ø–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É URL |
| `GET` | `/links/expired` | –°–ø–∏—Å–æ–∫ –∏—Å—Ç—ë–∫—à–∏—Ö —Å—Å—ã–ª–æ–∫ |
| `DELETE` | `/cleanup-unused-links?n_days=30` | –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Å—ã–ª–∫–∏ |
| `PUT` | `/links/{short_code}` | –û–±–Ω–æ–≤–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL |
| `DELETE` | `/links/{short_code}` | –£–¥–∞–ª–∏—Ç—å —Å—Å—ã–ª–∫—É *(–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω—É–∂–Ω–∞)* |

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `POST /register`  
2. –õ–æ–≥–∏–Ω –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ `POST /login`  
3. –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: `Authorization: Bearer <your_token>`

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è 
```bash
curl -X 'POST' \
  'http://localhost:8001/register' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "username": "username",
  "password": "password"
}'
```

### üîë –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è 
```bash
curl -X 'POST' \
  'http://localhost:8001/login' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -d 'grant_type=password&username=login&password=password&scope=&client_id=string&client_secret=string'
```

### üîó –°–æ–∫—Ä–∞—Ç–∏—Ç—å —Å—Å—ã–ª–∫—É
```bash
curl -X POST http://localhost:8001/links/shorten \
  -H "Authorization: Bearer <your_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "original_url": "https://example.com",
    "expires_at": "2025-04-01T12:00:00"
  }'
```

### üìä –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
```bash
curl http://localhost:8001/links/abc123/stats
```

### üîé –ü–æ–∏—Å–∫ –ø–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É URL
```bash
curl "http://localhost:8001/links/search?original_url=https://example.com"
```

### üßº –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å—Å—ã–ª–æ–∫
```bash
curl -X DELETE "http://localhost:8001/cleanup-unused-links?n_days=30"
```

---
## üõ†Ô∏è –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

### –®–∞–≥ 1. –ü—Ä–æ–ø–∏—Å–∞—Ç—å envs –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–º–ø–æ—É–∑–∞, –ª–∏–±–æ –≤ —Ñ–∞–π–ª–µ `.env`, –Ω–∞–ø—Ä–∏–º–µ—Ä
```yaml
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=shortener_db
REDIS_PORT=6379
REDIS_DB=0
```

### –®–∞–≥ 2. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –ø—Ä–∏–º–µ—Ä —Å —Ñ–∞–π–ª–æ–º
```bash
docker-compose --env-file .env up --build
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞:
http://localhost:8001 \
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8001/docs

## üíæ –ö—ç—à (Redis)
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ \
–ö—ç—à–∏—Ä—É–µ—Ç short_code ‚Üí original_url \
–ö—ç—à –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Å—ã–ª–∫–∏

---
## üåê –î–µ–º–æ-—Å–µ—Ä–≤–µ—Ä

–°–µ—Ä–≤–∏—Å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ –ª–∏—á–Ω–æ–º VPS –ø–æ –∞–¥—Ä–µ—Å—É:

üîó **http://185.250.45.224:8001/**  
üìÑ Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: **http://185.250.45.224:8001/docs**

---

# üìå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements-dev.txt
```

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
```bash
python -m pytest tests/ --cov=. --cov-report=html
```

## üìä –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–∞
–û—Ç–∫—Ä—ã—Ç—å `htmlcov/index.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

